language: scala

matrix:
  include:
  # The test matrix is manually spelled out, rather than relying
  # on the "automatic" matrix-generation by specifying the different
  # `scala`, `jdk`, and `env` values, because we want `artifacts` to
  # run first and `docs` last. For the auto-generated matrix, the
  # `artifacts` job will always run last with the `docs` job.

  # We want `artifacts` to run first, because apart from being the
  # slowest job of the lot, it also needs additional time for the
  # artifacts to sync from sonatype to maven central. `docs` should
  # be last to minimize the duration in which the new doc-site has
  # been published, but artifacts that the doc-site instructs people
  # to download are not yet present.

  - env: CI_SCRIPT="ci/build.sc artifacts"
    jdk: oraclejdk8
    scala: 2.11.8

  # Each `test` call is manually sharded out into `published/test` and
  # `integration/test`; for some reason, running them on the same box is
  # flaky and `integration/test` ends up hanging, even if they are run in
  # separate, sequential processes.
  - env: CI_SCRIPT="ci/build.sc test published/test"
    jdk: openjdk7
    scala: 2.10.5
  - env: CI_SCRIPT="ci/build.sc test integration/test"
    jdk: openjdk7
    scala: 2.10.5

  - env: CI_SCRIPT="ci/build.sc test published/test"
    jdk: oraclejdk8
    scala: 2.10.5
  - env: CI_SCRIPT="ci/build.sc test integration/test"
    jdk: oraclejdk8
    scala: 2.10.5


  - env: CI_SCRIPT="ci/build.sc test published/test"
    jdk: openjdk7
    scala: 2.11.8
  - env: CI_SCRIPT="ci/build.sc test integration/test"
    jdk: openjdk7
    scala: 2.11.8

  - env: CI_SCRIPT="ci/build.sc test published/test"
    jdk: oraclejdk8
    scala: 2.11.8
  - env: CI_SCRIPT="ci/build.sc test integration/test"
    jdk: oraclejdk8
    scala: 2.11.8


  - env: CI_SCRIPT="ci/build.sc docs"
    jdk: oraclejdk8
    scala: 2.11.8

script:
- export PATH=~/bin/amm:$PATH
- mkdir -p ~/bin
- curl -L -o ~/bin/amm https://git.io/vKwA8 && chmod +x ~/bin/amm
- which amm
- $CI_SCRIPT

notifications:
  email:
    - haoyi.sg@gmail.com

sudo: false
